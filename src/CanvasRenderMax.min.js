/*! CanvasRenderer - v0.0.1 - 2013-10-30 */
var CanvasRenderer={types:{RECT:"RECT",CIRCLE:"CIRCLE",TEXT:"TEXT",IMAGE:"IMAGE",LINE:"LINE"},lineType:{LINE:"LINE",CURVE:"CURVE",BEZIER_CURVE:"BEZIER_CURVE"},frameRate:35,timer:null,children:[],callbacks:[],uid:0,start:function(){},render:function(){for(var a=0;a<this.children.length;a++)this.checkChildren(this.children[a])},checkChildren:function(a){for(var b=0;b<a.children.length;b++){var c=!1,d=a.children[b];d.hasUpdates()&&(c||a.getContext("2d").clearRect(0,0,a.width(),a.height()),c=!0,d.style.updated(),this.updateAll(a))}},updateAll:function(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];switch(c.type){case this.types.RECT:this.drawRect(a,c);break;case this.types.CIRCLE:this.drawCircle(a,c);break;case this.types.TEXT:this.drawText(a,c);break;case this.types.IMAGE:this.drawImage(a,c);break;case this.types.LINE:this.drawLine(a,c)}}this.dispatch()},stop:function(){clearInterval(this.timer),this.timer=null},dispatch:function(){for(var a in this.callbacks)this.callbacks[a]()},addCallback:function(a,b){this.callbacks[a]=b},hasCallback:function(a){return this.callbacks[a]?!0:!1},removeCallback:function(a){this.callbacks[a]=null,delete this.callbacks[a]},getDisplayByUID:function(a){for(var b=0;b<this.children.length;b++)for(var c=this.children[b],d=0;d<c.children.length;d++)if(c.children[d].uid==a)return c.children[d];return null},getCanvasByUID:function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.uid==a)return c}return null},drawRect:function(a,b){var c=a.getContext("2d");if(c.beginPath(),c.rect(b.style.x(),b.style.y(),b.style.width(),b.style.height()),b.style.backgroundColor()){var d=this.hexToRgb(b.style.backgroundColor());c.fillStyle=d.replace("[x]",b.style.opacity()),c.fill()}b.style.strokeStyle()&&(d=this.hexToRgb(b.style.strokeStyle()),c.lineWidth=b.style.lineWidth(),c.strokeStyle=d.replace("[x]",b.style.opacity()),c.stroke())},drawCircle:function(a,b){var c=a.getContext("2d");c.beginPath();var d=b.style.radius(),e=b.style.x()+d,f=b.style.y()+d;if(c.arc(e,f,d,0,2*Math.PI,!1),b.style.backgroundColor()){var g=this.hexToRgb(b.style.backgroundColor());c.fillStyle=g.replace("[x]",b.style.opacity()),c.fill()}b.style.strokeStyle()&&(c.lineWidth=b.style.lineWidth(),g=this.hexToRgb(b.style.strokeStyle()),c.strokeStyle=g.replace("[x]",b.style.opacity()),c.stroke())},drawText:function(a,b){var c=a.getContext("2d"),d=this.hexToRgb(b.color());c.fillStyle=d.replace("[x]",b.style.opacity()),c.textBaseline=b.style.textBaseline(),c.font=b.style.font(),c.lineWidth=b.style.lineWidth(),c.textAlign=b.style.textAlign(),c.fillText(b.strokeText,b.style.x(),b.style.y()),c.stroke()},drawImage:function(a,b){var c=a.getContext("2d");null!=b.clipping?c.drawImage(b.img,b.clipping.x,b.clipping.y,b.clipping.w,b.clipping.h,b.style.x(),b.style.y(),b.style.width(),b.style.height()):c.drawImage(b.img,b.style.x(),b.style.y(),b.style.width(),b.style.height())},drawLine:function(a,b){var c=a.getContext("2d");c.beginPath(),c.moveTo(b.style.x(),b.style.y());for(var d in b.lines){var e=b.lines[d];switch(e.type){case this.lineType.LINE:c.lineTo(e.x,e.y);break;case this.lineType.CURVE:c.quadraticCurveTo(e.cpx,e.cpy,e.x,e.y);break;case this.lineType.BEZIER_CURVE:c.bezierCurveTo(e.cp1x,e.cp1y,e.cp2x,e.cp2y,e.x,e.y)}}if(b.style.backgroundColor()){var f=this.hexToRgb(b.style.backgroundColor());c.fillStyle=f.replace("[x]",b.style.opacity()),c.fill()}c.lineWidth=b.style.lineWidth(),f=this.hexToRgb(b.style.strokeStyle()),c.strokeStyle=f.replace("[x]",b.style.opacity()),c.stroke()},hexToRgb:function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(!c)return a;var d={r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)};return"rgba("+d.r+","+d.g+","+d.b+",[x])"}},Canvas=function(){this.element=null,this.children=[],this.uid=null};!function(){var a=Canvas.prototype;a.build=function(){this.uid=CanvasRenderer.uid++,this.element=document.createElement("CANVAS"),CanvasRenderer.children.push(this),CanvasRenderer.start()},a.width=function(a){return void 0!=a&&(this.element.width=a),this.element.width},a.height=function(a){return void 0!=a&&(this.element.height=a),this.element.height},a.getContext=function(a){return this.element.getContext(a)},a.getChildByUID=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.uid==a)return c}return null},a.appendChild=function(a){a.canvasUID=this.uid,this.children.push(a),CanvasRenderer.render()},a.removeChild=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.uid==a.uid)return this.children.splice(b,1),void 0}}}();var CanvasDisplayObject=function(){this.children=[],this.update=!1,this.style=null,this.id="",this.uid=null,this.canvasUID=null,this.type=CanvasRenderer.types.RECT,this.state=""};!function(){var a=CanvasDisplayObject.prototype;a.build=function(){this.uid=CanvasRenderer.uid++,this.style=new CanvasStyle,this.style.uid=CanvasRenderer.uid++},a.hasUpdates=function(){var a=this.style.check();if(a)for(var b=0;b<this.children.length;b++)this.children[b].style.hasUpdates=!0;return a},a.appendChild=function(a){a.style.parent=this,a.canvasUID=this.canvasUID,this.children.push(a),CanvasRenderer.getCanvasByUID(this.canvasUID).appendChild(a)},a.removeChild=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];c.uid==a.uid&&this.children.splice(b,1)}CanvasRenderer.getCanvasByUID(this.canvasUID).removeChild(a)},a.hitTestPoint=function(a,b){return this.style.x()<=a&&a<=this.style.x()+this.style.width()&&this.style.y()<=b&&b<=this.style.y()+this.style.height()?!0:!1}}(),function(){var a=Canvas.prototype;a.listeners=[],a.dispatchToListeners=function(a,b){if(this.listeners[b]){var c=a.pageX-this.element.offsetLeft,d=a.pageY-this.element.offsetTop;for(var e in this.listeners[b].callbacks){var f=this.getChildByUID(e),g=!1;switch(b){case"click":case"mousedown":case"mouseup":case"mousemove":(!f||f.hitTestPoint(c,d))&&(g=!0);break;case"mouseover":(!f||f.hitTestPoint(c,d))&&(g=!0,f.state="mouseover");break;case"mouseout":(!f||!f.hitTestPoint(c,d)&&"mouseover"==f.state)&&(f.state="",g=!0)}g&&this.listeners[b].callbacks[e](a)}}},a.addEventListener=function(a,b){var c=this;this.listeners[a]||(this.listeners[a]={event:function(b){c.dispatchToListeners(b,a)},callbacks:[]},canvas.element.addEventListener(a,canvas.listeners[a].event)),this.listeners[a].callbacks[this.uid]||(this.listeners[a].callbacks[this.uid]=b)},a.removeEventListener=function(a,b){if(this.listeners[a]&&this.listeners[a].callbacks[this.uid]){for(var c=0;c<this.listeners[a].callbacks.length;c++)if(void 0==this.listeners[a].callbacks[c]&&(this.listeners[a].callbacks.splice(c,1),c--),this.listeners[a].callbacks[c]==b){this.listeners[a].callbacks.splice(c,1);break}0==this.listeners[a].callbacks.length&&(canvas.element.removeEventListener(a,canvas.listeners[a].event),this.listeners[a]=null)}}}(),function(){var a=CanvasDisplayObject.prototype;a.addEventListener=function(a,b){var c=CanvasRenderer.getCanvasByUID(this.canvasUID);if(!c.listeners[a]){c.listeners[a]={event:function(b){c.dispatchToListeners(b,a)},callbacks:[]};var d=a;("mouseover"==a||"mouseout"==a)&&(d="mousemove"),c.element.addEventListener(d,c.listeners[a].event)}c.listeners[a].callbacks[this.uid]||(c.listeners[a].callbacks[this.uid]=b)},a.removeEventListener=function(a,b){var c=CanvasRenderer.getCanvasByUID(this.canvasUID);if(c.listeners[a]&&c.listeners[a].callbacks[this.uid]){for(var d=0;d<c.listeners[a].callbacks.length;d++)if(void 0==c.listeners[a].callbacks[d]&&(c.listeners[a].callbacks.splice(d,1),d--),c.listeners[a].callbacks[d]==b){c.listeners[a].callbacks.splice(d,1);break}if(0==c.listeners[a].callbacks.length){switch(a){case"mouseover":case"mouseout":c.listeners.mousemove||c.element.removeEventListener("mousemove",c.listeners[a].event);break;default:c.element.removeEventListener(a,c.listeners[a].event)}c.listeners[a]=null}}}}();var CanvasImage=function(){this.type=CanvasRenderer.types.IMAGE,this.img=null,this.clipping=null,this.src=function(a){return!this.style&&a&&this.build(),void 0!=a&&(this.img=new Image,this.img.src=a),this.img.src},this.clip=function(a,b,c,d){this.clipping=null==a?null:{x:a,y:b,w:c,h:d},CanvasRenderer.render()}};!function(){CanvasImage.prototype=new CanvasDisplayObject,CanvasImage.prototype.constructor=CanvasDisplayObject}();var CanvasStyle=function(){this.parent=null,this.hasUpdates=!1,this.props={}};!function(){var a=CanvasStyle.prototype;a.width=function(a){return void 0!=a&&this.updateProp("width",a),void 0!=this.props.width?this.scaleX()*this.props.width.value:0},a.x=function(a){return void 0!=a&&this.updateProp("x",a),this.getVal("x",0)},a.y=function(a){return void 0!=a&&this.updateProp("y",a),this.getVal("y",0)},a.height=function(a){return void 0!=a&&this.updateProp("height",a),void 0!=this.props.height?(this.type==CanvasRenderer.types.CIRCLE?this.scaleX():this.scaleY())*this.props.height.value:0},a.scaleX=function(a){return void 0!=a&&this.updateProp("scaleX",a),this.getNested("scaleX",1)},a.scaleY=function(a){return void 0!=a&&this.updateProp("scaleY",a),this.getNested("scaleY",1)},a.radius=function(a){return void 0!=a&&this.updateProp("radius",a),void 0!=this.props.radius?this.scaleX()*this.props.radius.value:0},a.opacity=function(a){return void 0!=a&&this.updateProp("opacity",a),this.getNested("opacity",1)},a.backgroundColor=function(a){return void 0!=a&&this.updateProp("backgroundColor",a),void 0!=this.props.backgroundColor?this.props.backgroundColor.value:""},a.font=function(a){return void 0!=a&&this.updateProp("font",a),void 0!=this.props.font?this.props.font.value:"40px san-serif"},a.textBaseline=function(a){return void 0!=a&&this.updateProp("textBaseline",a),void 0!=this.props.textBaseline?this.props.textBaseline.value:"top"},a.textAlign=function(a){return void 0!=a&&this.updateProp("textAlign",a),void 0!=this.props.textAlign?this.props.textAlign.value:"start"},a.lineWidth=function(a){return void 0!=a&&this.updateProp("lineWidth",a),void 0!=this.props.lineWidth?this.props.lineWidth.value:""},a.strokeStyle=function(a){return void 0!=a&&this.updateProp("strokeStyle",a),void 0!=this.props.strokeStyle?this.props.strokeStyle.value:""},a.updateProp=function(a,b){this.props[a]||(this.props[a]={value:b,updated:!1}),this.props[a].value=b,this.props[a].updated=!0,this.hasUpdates=!0,CanvasRenderer.render()},a.getVal=function(a,b){return void 0==this.props[a]?b:this.parent?this.parent.style[a]()+this.props[a].value:this.props[a].value},a.getNested=function(a,b){return this.parent?void 0==this.props[a]?this.parent.style[a]()*b:this.parent.style[a]()<1?this.parent.style[a]()*this.props[a].value:this.props[a].value<0?0:this.props[a].value:this.props[a]?this.props[a].value:b},a.setVal=function(a,b){return!this.parent||isNaN(a)?a:a-this.parent.style[b]()},a.check=function(){return this.hasUpdates},a.updated=function(){for(var a in this.props)this.props[a].updated=!1}}();var CanvasTween={index:0,items:[],timers:[],render:null,ease:{easeIn:"ease-in",easeOut:"ease-out",strongEaseOut:"strong-ease-out",easeBack:"ease-back",easeInOut:"ease-in-out"},to:function(a,b,c){var d=this;this.index++,c.delay?this.timers[this.index]=setTimeout(function(){d.addItem(a,b,c)},1e3*c.delay):this.addItem(a,b,c)},addItem:function(a,b,c){this.items.push({obj:a,d:b,options:c}),this.index++,this.addRender()},addRender:function(){var a=this;this.render||(this.render=setInterval(function(){a.calculateMovement()},CanvasRenderer.frameRate))},calculateMovement:function(){for(var a=0;a<this.items.length;a++){var b=0,c=0,d=this.items[a].obj;for(var e in this.items[a].options){var f=this.items[a].options[e],g=this.items[a].options.ease;if("onComplete"!=e&&"delay"!=e&&"ease"!=e){void 0==this.items[a].options[e].originalVal&&(this.items[a].options[e]={value:f,end:!1,currentFrame:0,originalVal:null},f=this.items[a].options[e]),b++,String(f.value).replace("px","");var h=d.style[e]();null==f.originalVal&&(f.originalVal=h);var i=f.currentFrame/CanvasRenderer.frameRate;if(f.currentFrame<=CanvasRenderer.frameRate){var j=this.getFactor(g,i,f.originalVal,f.value-f.originalVal,1),k=f.originalVal+(f.value-f.originalVal)*j;this.items[a].obj.style[e](k),f.currentFrame++}else f.end=!0,c++}}c==b&&(this.items[a].options.onComplete&&this.items[a].options.onComplete(),this.removeItem(a))}},getFactor:function(a,b,c,d,e){switch(a){case this.ease.easeIn:return this.easeIn(b,e);case this.ease.strongEaseOut:return this.strongEaseOut(b,e);case this.ease.easeOut:return this.easeOut(b,c,d,e,5);case this.ease.easeBack:return this.easeOut(b,c,d,e,5);case this.ease.easeInOut:return this.easeInOut(b,c,d,e,5);default:return this.noEasing(b,e)}},noEasing:function(a,b){return a/b},easeIn:function(a,b){return Math.pow(a/b,5)},strongEaseOut:function(a,b){return 1-Math.pow(1-a/b,5)},easeOut:function(a,b,c,d,e){return 1-Math.pow(1-a/d,e)},easeBack:function(a,b,c,d,e){return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeInOut:function(a,b,c,d,e){return a>d/2?this.easeOut(a,b,c,d,e):this.easeIn(a,b,c,d)},removeItem:function(a){this.items[a]=null,this.items.splice(a,1),0==this.items.length&&this.stopAll()},stopAll:function(){clearInterval(this.render),this.render=null}},Sprite=function(){this.lines=[],this.beginFill=function(a,b){this.style||this.build(),this.style.backgroundColor(a),b&&this.style.opacity(b)},this.drawCircle=function(a,b,c){this.type="CIRCLE",this.style.x(a),this.style.y(b),this.style.radius(c),this.style.width(2*c),this.style.height(2*c)},this.drawRect=function(a,b,c,d){this.type=CanvasRenderer.types.RECT,this.style.x(a),this.style.y(b),this.style.width(c),this.style.height(d)},this.moveTo=function(a,b){this.style||this.build(),this.type="LINE",this.style.x(a),this.style.y(b),this.lines=[]},this.lineTo=function(a,b){this.lines.push({type:CanvasRenderer.lineType.LINE,x:a,y:b})},this.quadraticCurveTo=function(a,b,c,d){this.lines.push({type:CanvasRenderer.lineType.CURVE,x:c,y:d,cpx:a,cpy:b})},this.bezierCurveTo=function(a,b,c,d,e,f){this.lines.push({type:CanvasRenderer.lineType.BEZIER_CURVE,x:e,y:f,cp1x:a,cp1y:b,cp2x:c,cp2y:d})}};!function(){Sprite.prototype=new CanvasDisplayObject,Sprite.prototype.constructor=CanvasDisplayObject}();var TextField=function(){this.type=CanvasRenderer.types.TEXT,this.strokeText="",this._color="#000",this.text=function(a){this.strokeText=a,CanvasRenderer.render()},this.color=function(a){return a&&(this._color=a,CanvasRenderer.render()),this._color}};!function(){TextField.prototype=new CanvasDisplayObject,TextField.prototype.constructor=CanvasDisplayObject}();